## 一、软件简介

无人机辅助的物联网数据收集是当前的研究热点，本软件可以为这类研究提供基于WLAN直连的实机验证平台。**Wifi P2P** 是在 **Android 4.0** 以及更高版本系统中加入的功能，通过 **Wifi P2P** 可以在**不连接公有网络**的情况下，直接与配对的设备进行数据交换。相对于蓝牙，**Wifi P2P** 的搜索速度和传输速度更快，传输距离更远

> 软件主要功能：
>> 1. 软件可以使移动终端在没有中间接入点的情况下，通过WLAN直联高速传输数据。
>> 2. 软件同时支持发送和接收两种模式。
>>> - 发送模式：可设置设备ID，存储上限，数据生成间隔等属性，实时记录并展示数据队列情况。
>>> - 接收模式：可设置设备的可靠性，实时展示当前连接设备数量、任务开始时间、数据收集策略等。
>> 3. 中控节点通过HTTP请求的方式向接收方下达数据收集策略，发送方与接收方建立连接后，接收方根据调度策略收集发送方数据，实时展示发送方状态信息。

## 二、软件实现方案

系统开发语言采用Kotlin语言，Kotlin是一款简洁，安全，可与Java无缝衔接使用的现代开发语言。线程调度使用Kotlin协程，Kotlin协程是一种并发设计模式，提供了简洁、清晰、易用的线程调度接口。对外接口模块采用Ktor框架，Ktor是一款轻巧灵活的开源服务器框架，基于Kotlin协程实现，可兼容多种终端设备，可在AndroiD端轻松创建服务器应用，并向外提供HTTP接口访问。  
不同模式下的终端通过网络服务发现方式搜索设备，通过WLAN直连方式点对点通信，这种方式不依赖任何公有网络，可在完全无通信基础设施的情况下，通过WLAN发现其他设备，并建立通信。同时建立通信后不影响其他网络使用，终端仍可连接移动网络或WiFi，并正常进行Internet连接。

### 2.1 系统总体框架

系统架构如下图所示，总体上系统架构可以分为两层：基础服务层和应用功能层。基础服务包括了数据管理服务，无线通信服务和对外接口服务。应用功能层采用发送/接收模式一体化集成的方式，根据数据传输需要可以动态切换应用的功能模式。

![系统架构图](img_folder\架构.png)

### 2.2 发送端运行流程
![发送流程图](img_folder\发送流程.png)

### 2.3 接收端运行流程
![接收流程图](img_folder\接收流程.png)

### 2.4 应用端对外接口函数
| 接口名                  | 请求方式   | 传参方式       | 说明                           |
|----------------------|--------|------------|------------------------------|
| setLimitedSendSize   | Post   | Body       | 设置接收端接收方案，即各发送端可向接收端上传的最大数据量 |
| canSend              | Get    | Parameters | 发送方调用接收方接口，获取自身最大可上传数据量      |
| getPlanResult        | Get    | 无          | 获取接收端接收结果，如未全部接收完成，则返回undone |
| getReceivedFileList  | Get    | 无          | 获取接收端已收到的文件名列表，按发送端ID分组      |
| setReceivedFileList  | Post   | Body       | 设置接收端已收到的文件名列表，按发送端ID分组      |
| getGenerateParameter | Get    | 无          | 获取发送端生成数据的参数配置               |
| setGenerateParameter | Post   | Body       | 设置发送端生成数据的参数配置               |
| setQuickGenerateSize | Post   | Parameters | 使发送端快速生成指定大小数据               |
| clearPlanData        | Delete | 无          | 清除接收端收到的所有数据                 |
| clearGenerateData    | Delete | 无          | 清除发送端生成的所有数据及日志              |

## 三、场景实验验证

- 实验场景设置

     ![实验场景](img_folder\场景.jpg)

- 基站

     ![基站](img_folder\bs.jpg)

- UAV

     ![无人机](img_folder\UAV.jpg)

- 终端设备部署

     ![发送端部署](img_folder\发送端部署.png)

- 数据发送端界面

    ![发送端界面](img_folder\Sender.jpg)

- 数据接收端界面

     ![发送端界面](img_folder\receiver.jpg)

- 样本数据

     ![数据](img_folder\data.jpg)